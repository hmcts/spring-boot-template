#!groovy

node {
  stage('Checkout') {
   deleteDir()
   checkout scm
  }
  stage('Sonar') {
    withSonarQubeEnv("SonarQube") {
      sh "./gradlew --info sonarqube"
    }

    def qg = waitForQualityGate()
    if (qg.status != 'OK') {
      error "Pipeline aborted due to quality gate failure: ${qg.status}"
    }
  }

}

